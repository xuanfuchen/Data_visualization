{% extends "base.html" %}
{% load static %}
<!-- title defined in base.html -->
{% block title %}
Data Visualization
{% endblock title %}

<!-- contents -->
{% block content %}
<!-- css for the page (sometimes runserver is not response to the updates in static file for some reason) -->
<style>
  body {
    background-color: #808080;
  }

  div .container-fluid{
    border: solid;
    background-color: white;
  }

  div #world_map_count {
    border: solid;
    width: 1200px;
    height: 600px;
    margin:20px;
  }
</style>

<!--------------------------------------------------- page --------------------------------------------------->
<div class="container-fluid">
  <div class="container-fluid" id="world_map_count"></div>
</div>
<div class="row mt-2" id="world_map_sales" style="width: 600px;height:400px;"></div>


<!--------------------------------------------------- charts --------------------------------------------------->
<script>  //world map with stock count in each country
  var ROOT_PATH = 'https://fastly.jsdelivr.net/gh/apache/echarts-website@asf-site/examples';

  var chartDom = document.getElementById('world_map_count');
  var myChart = echarts.init(chartDom, 'better_dark');
  var option;

  var MAX_VAL = 3000;
  var MIN_VAL = 1;

  myChart.showLoading();
  $.get(ROOT_PATH + '/data/asset/geo/world.json', function (worldJson) {
    myChart.hideLoading();
    echarts.registerMap('world', worldJson, {
    });
    var data = [
      { name: 'China', value: 4822023 },
      { name: 'United States', value: 731449 },
      { name: 'Canada', value: 6553255 },
    ];
    data.sort(function (a, b) {
      return a.value - b.value;
    });
    const mapOption = {
      visualMap: {
        left: 'right',
        min: MIN_VAL,
        max: MAX_VAL,
        inRange: {
          // prettier-ignore
          color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']
        },
        text: ['High', 'Low'],
        calculable: true
      },
      series: [
        {
          id: 'count',
          type: 'map',
          roam: true,
          map: 'world',
          animationDurationUpdate: 1000,
          universalTransition: true,
          data: data
        }
      ]
    };
    const barOption = {
      xAxis: {
        type: 'value'
      },
      yAxis: {
        type: 'category',
        axisLabel: {
          rotate: 30
        },
        data: data.map(function (item) {
          return item.name;
        })
      },
      animationDurationUpdate: 1000,
      series: {
        type: 'bar',
        id: 'count',
        data: data.map(function (item) {
          return item.value;
        }),
        universalTransition: true
      }
    };
    let currentOption = mapOption;
    myChart.setOption(mapOption);
    $("#world_map_count").click(function () {
      currentOption = currentOption === mapOption ? barOption : mapOption;
      myChart.setOption(currentOption, true);
    });
  });

  option && myChart.setOption(option);

</script>

{% endblock content %}